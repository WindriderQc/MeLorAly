<!-- Education Resources -->
<div class="min-h-screen bg-background-light pb-24">
    <!-- Header -->
    <div class="bg-gradient-to-br from-green-500 to-blue-500 text-white px-6 py-8 rounded-b-3xl">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-black mb-2 flex items-center gap-2">
                <span class="material-symbols-outlined text-4xl filled">school</span>
                Ressources éducatives
            </h1>
            <p class="text-white/90">Activités et contenus adaptés à chaque âge</p>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 py-6">
        <!-- Age Filter Tabs -->
        <div class="bg-white rounded-2xl shadow-sm p-4 mb-6">
            <div class="flex gap-2 overflow-x-auto">
                <% ageFilters.forEach((filter, index) => { %>
                    <button type="button"
                            onclick="filterAge('<%= filter.id %>', event)"
                            class="age-filter px-6 py-3 rounded-xl font-bold whitespace-nowrap transition <%= index === 0 ? 'bg-primary text-gray-900' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
                        <%= filter.label %>
                    </button>
                <% }); %>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <% categories.forEach(category => { 
                    const categoryActivities = activitiesByCategory[category.id] || [];
                    if (categoryActivities.length === 0) return;
                %>
                    <section data-category-section>
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-black text-gray-900 flex items-center gap-2">
                                <span class="material-symbols-outlined <%= category.iconColorClass %> filled"><%= category.icon %></span>
                                <%= category.name %>
                            </h2>
                            <a href="<%= category.viewAllPath %>" class="text-sm font-bold text-primary hover:underline">Voir tout</a>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <% categoryActivities.forEach(activity => {
                                const completedChildren = completionMap[activity.id] || [];
                                const isCompleted = completedChildren.length > 0;
                            %>
                                <article class="bg-white rounded-2xl shadow-sm overflow-hidden hover:shadow-lg transition group flex flex-col"
                                         data-age-groups="<%= activity.ageRanges.join(',') %>"
                                         data-activity-id="<%= activity.id %>">
                                    <div class="h-40 bg-gradient-to-br <%= activity.gradient %> flex items-center justify-center">
                                        <span class="material-symbols-outlined text-white text-6xl"><%= activity.icon %></span>
                                    </div>
                                    <div class="p-5 flex flex-col gap-3 flex-1">
                                        <span class="inline-block <%= activity.badgeClass %> px-3 py-1 rounded-full text-xs font-bold">
                                            <%= activity.ageRanges.join(' · ') %>
                                        </span>
                                        <h3 class="font-bold text-gray-900 text-lg"><%= activity.title %></h3>
                                        <p class="text-sm text-gray-600 flex-1"><%= activity.summary %></p>
                                        <div class="flex items-center justify-between text-xs text-gray-500">
                                            <span class="flex items-center gap-1">
                                                <span class="material-symbols-outlined text-sm">schedule</span>
                                                <%= activity.durationMinutes %> min
                                            </span>
                                            <% if (isCompleted) { %>
                                                <span class="flex items-center gap-1 text-green-600 font-semibold">
                                                    <span class="material-symbols-outlined text-sm filled">task_alt</span>
                                                    Terminé
                                                </span>
                                            <% } %>
                                        </div>
                                        <a href="/education/activity/<%= activity.id %>"
                                           class="w-full bg-primary text-gray-900 px-4 py-2 rounded-xl font-bold hover:shadow-lg transition text-center">
                                            Voir l'activité
                                        </a>
                                    </div>
                                </article>
                            <% }); %>
                        </div>
                    </section>
                <% }); %>

                <div id="activity-empty-state" class="hidden">
                    <div class="bg-white border-2 border-dashed border-gray-200 rounded-2xl p-8 text-center">
                        <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">lightbulb</span>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Aucune activité pour cet âge</h3>
                        <p class="text-sm text-gray-600">Sélectionnez un autre filtre d'âge pour découvrir davantage de ressources.</p>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <% 
                    const completionPercent = progress.total > 0 ? Math.round((progress.completed / progress.total) * 100) : 0;
                    const hoursSpent = Math.floor((progress.minutes || 0) / 60);
                    const minutesSpent = (progress.minutes || 0) % 60;
                %>
                <!-- Progress Card -->
                <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-green-600">trending_up</span>
                        Progression
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Activités complétées</span>
                                <span class="font-bold text-gray-900"><%= progress.completed %>/<%= progress.total %></span>
                            </div>
                            <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-green-500 rounded-full" style="width: <%= completionPercent %>%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Temps d'apprentissage</span>
                                <span class="font-bold text-gray-900">
                                    <% if (hoursSpent > 0) { %>
                                        <%= hoursSpent %>h <%= minutesSpent %>min
                                    <% } else { %>
                                        <%= minutesSpent %> min
                                    <% } %>
                                </span>
                            </div>
                            <div class="text-xs text-gray-500">Basé sur les activités complétées</div>
                        </div>
                    </div>
                </div>

                <!-- Recommended -->
                <div class="bg-gradient-to-br from-primary/10 to-pink-50 rounded-2xl p-6">
                    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">stars</span>
                        Recommandé pour vous
                    </h3>
                    <div class="space-y-3">
                        <% recommendedActivities.slice(0, 3).forEach(activity => { %>
                            <div class="bg-white rounded-xl p-4">
                                <h4 class="font-bold text-gray-900 text-sm mb-1"><%= activity.title %></h4>
                                <p class="text-xs text-gray-600 mb-2"><%= activity.summary %></p>
                                <a href="/education/activity/<%= activity.id %>" class="text-xs font-bold text-primary hover:underline">
                                    Ouvrir l'activité
                                </a>
                            </div>
                        <% }); %>
                        <% if (recommendedActivities.length === 0) { %>
                            <p class="text-sm text-gray-600">Complétez des activités pour recevoir des recommandations personnalisées.</p>
                        <% } %>
                    </div>
                </div>

                <!-- Tips -->
                <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-6">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center flex-shrink-0">
                            <span class="material-symbols-outlined text-white filled">lightbulb</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-900 mb-1">Conseil</h3>
                            <p class="text-sm text-gray-600">
                                Programmez une session courte chaque jour pour garder le rythme. 15 minutes suffisent pour progresser régulièrement.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function filterAge(age, event) {
    const cards = document.querySelectorAll('[data-age-groups]');
    const buttons = document.querySelectorAll('.age-filter');
    const emptyState = document.getElementById('activity-empty-state');
    let visibleCount = 0;

    cards.forEach(card => {
        const groups = card.dataset.ageGroups.split(',');
        const shouldShow = age === 'all' || groups.includes(age);
        card.classList.toggle('hidden', !shouldShow);
        if (shouldShow) {
            visibleCount += 1;
        }
    });

    document.querySelectorAll('[data-category-section]').forEach(section => {
        const visibleCards = section.querySelectorAll('[data-age-groups]:not(.hidden)');
        section.classList.toggle('hidden', visibleCards.length === 0);
    });

    buttons.forEach(button => {
        button.classList.remove('bg-primary', 'text-gray-900');
        button.classList.add('bg-gray-100', 'text-gray-700');
    });

    if (event && event.currentTarget) {
        event.currentTarget.classList.remove('bg-gray-100', 'text-gray-700');
        event.currentTarget.classList.add('bg-primary', 'text-gray-900');
    } else if (buttons.length > 0) {
        buttons[0].classList.remove('bg-gray-100', 'text-gray-700');
        buttons[0].classList.add('bg-primary', 'text-gray-900');
    }

    emptyState.classList.toggle('hidden', visibleCount > 0);
}

document.addEventListener('DOMContentLoaded', () => {
    filterAge('all');
});
</script>
